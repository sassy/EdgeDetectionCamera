<!DOCTYPE html>
<html>
<head>
<title>Edge for Video</title>
<style>
video {
    display:none;
}
</style>
<script type="text/javascript">

function getPosition(i, j, width) {
  return (i * 4 * width) + j * 4;
}

function displayEdgeToCanvas(srcCanvas, dstCanvas) {
  var srcCtx = srcCanvas.getContext("2d");
  var dstCtx = dstCanvas.getContext("2d");
  var src = srcCtx.getImageData(0, 0, srcCanvas.width, srcCanvas.height);
  var dst3 = dstCtx.createImageData(dstCanvas.width, dstCanvas.height);
  for (var i = 1; i < dstCanvas.height-1; i++) {
      for (var j = 1; j < dstCanvas.width-1; j++) {
          var pos = new Array();
          pos[0] = getPosition(i-1, j-1, dstCanvas.width);
          pos[1] = getPosition(i-1, j,   dstCanvas.width);
          pos[2] = getPosition(i-1, j+1, dstCanvas.width);
          pos[3] = getPosition(i,   j-1, dstCanvas.width);
          pos[4] = getPosition(i,   j,   dstCanvas.width);
          pos[5] = getPosition(i,   j+1, dstCanvas.width);
          pos[6] = getPosition(i+1, j-1, dstCanvas.width);
          pos[7] = getPosition(i+1, j,   dstCanvas.width);
          pos[8] = getPosition(i+1, j+1, dstCanvas.width);

          dst3.data[pos[4]] = 255 - (src.data[pos[0]] + src.data[pos[1]] + src.data[pos[2]] + src.data[pos[3]] + (src.data[pos[4]] * -8) + src.data[pos[5]] + src.data[pos[6]] + src.data[pos[7]] + src.data[pos[8]]);
          dst3.data[pos[4]+1] = 255 - (src.data[pos[0]+1] + src.data[pos[1]+1] + src.data[pos[2]+1] + src.data[pos[3]+1] + (src.data[pos[4]+1] * -8) + src.data[pos[5]+1] + src.data[pos[6]+1] + src.data[pos[7]+1] + src.data[pos[8]+1]);
          dst3.data[pos[4]+2] = 255 - (src.data[pos[0]+2] + src.data[pos[1]+2] + src.data[pos[2]+2] + src.data[pos[3]+2] + (src.data[pos[4]+2] * -8) + src.data[pos[5]+2] + src.data[pos[6]+2] + src.data[pos[7]+2] + src.data[pos[8]+2]);
          dst3.data[pos[4]+3] = src.data[pos[4]+3];

      }
  }
  dstCtx.putImageData(dst3, 0, 0);
}

window.onload = function() {
    if (navigator.webkitGetUserMedia) {
      navigator.getUserMedia = navigator.webkitGetUserMedia;
    } else if(navigator.mozGetUserMedia) {
      navigator.getUserMedia = navigator.mozGetUserMedia;
    }

    if (navigator.getUserMedia) {
      navigator.getUserMedia({video: true, audio: true}, function(localMediaStream) {
            var video = document.querySelector('video');
            video.src = window.URL.createObjectURL(localMediaStream);
            video.addEventListener('timeupdate', function() {

                var canvas = document.createElement("canvas");
                var ctx = canvas.getContext("2d");
                var canvas3 = document.getElementById("c3");

                canvas.width = canvas3.width = video.videoWidth;
                canvas.height = canvas3.height = video.videoHeight;

                ctx.drawImage(video, 0, 0);
                displayEdgeToCanvas(canvas, canvas3);

            }, false);
        }, function(e) {
          console.log(e);
        });
    } else {
      console.log("error");
    }
};
</script>
</head>
<body>
  <canvas id="c3" width="300" height="300"></canvas>
  <video autoplay></video><br><br>
</body>
</html>
