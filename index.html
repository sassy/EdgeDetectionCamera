<!DOCTYPE html>
<html>
<head>
<title>Edge for Video</title>
<style>
#c1 {
    display:none;
}
video {
    display:none;
}
</style>
<script type="text/javascript">
const THRESHOLD = 65;

function getPosition(i, j, width) {
    return (i * 4 * width) + j * 4;
}

window.onload = function() {

    if (navigator.webkitGetUserMedia) {
	navigator.getUserMedia = navigator.webkitGetUserMedia;
    } else if(navigator.mozGetUserMedia) {
	navigator.getUserMedia = navigator.mozGetUserMedia;
    }
 
    if (navigator.getUserMedia) {
	navigator.getUserMedia({video: true, audio: true}, function(localMediaStream) {
            var video = document.querySelector('video');
	    video.src = window.URL.createObjectURL(localMediaStream);
            video.addEventListener('timeupdate', function() {

                var canvas = document.getElementById("c1");
                var canvas3 = document.getElementById("c3");
                var ctx = canvas.getContext("2d");
                var ctx3 = canvas3.getContext("2d");
                
                canvas.width = canvas3.width = video.videoWidth;
                canvas.height = canvas3.height = video.videoHeight;
                ctx.drawImage(video, 0, 0);

                var src = ctx.getImageData(0, 0, canvas.width, canvas.height);
                var dst3 = ctx3.createImageData(canvas3.width, canvas3.height);
                for (var i = 1; i < canvas3.height-1; i++) {
                    for (var j = 1; j < canvas3.width-1; j++) {
                        var pos = new Array();
                        pos[0] = getPosition(i-1, j-1, canvas3.width);
                        pos[1] = getPosition(i-1, j,   canvas3.width);
                        pos[2] = getPosition(i-1, j+1, canvas3.width);
                        pos[3] = getPosition(i,   j-1, canvas3.width);
                        pos[4] = getPosition(i,   j,   canvas3.width);
                        pos[5] = getPosition(i,   j+1, canvas3.width);
                        pos[6] = getPosition(i+1, j-1, canvas3.width);
                        pos[7] = getPosition(i+1, j,   canvas3.width);
                        pos[8] = getPosition(i+1, j+1, canvas3.width);

                        dst3.data[pos[4]] = 255 - (src.data[pos[0]] + src.data[pos[1]] + src.data[pos[2]] + src.data[pos[3]] + (src.data[pos[4]] * -8) + src.data[pos[5]] + src.data[pos[6]] + src.data[pos[7]] + src.data[pos[8]]);
                        dst3.data[pos[4]+1] = 255 - (src.data[pos[0]+1] + src.data[pos[1]+1] + src.data[pos[2]+1] + src.data[pos[3]+1] + (src.data[pos[4]+1] * -8) + src.data[pos[5]+1] + src.data[pos[6]+1] + src.data[pos[7]+1] + src.data[pos[8]+1]);
                        dst3.data[pos[4]+2] = 255 - (src.data[pos[0]+2] + src.data[pos[1]+2] + src.data[pos[2]+2] + src.data[pos[3]+2] + (src.data[pos[4]+2] * -8) + src.data[pos[5]+2] + src.data[pos[6]+2] + src.data[pos[7]+2] + src.data[pos[8]+2]);
                        dst3.data[pos[4]+3] = src.data[pos[4]+3];
                
                    }
                }
                ctx3.putImageData(dst3, 0, 0);
            }, false);
        }, function(e) {
	    console.log(e);
        });
    } else {
	console.log("error");
    }
};
</script>
</head>
<body>
  <canvas id="c3" width="300" height="300"></canvas>  
  <video autoplay></video><br><br>
  <canvas id="c1" width="300" height="300"></canvas>
</body>
</html>
